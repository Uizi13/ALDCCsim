<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.16.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ALDCC simulator: Details</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen-custom.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ALDCC simulator<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">A program for analysis of linear direct current circuits.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.16.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md_docs_2doxygen__detailed__documentation.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Details </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md23"></a></p>
<p>ALDCCsim is a C++ command-line tool designed to solve linear electrical circuits using Modified Nodal Analysis (MNA). The solver supports resistors, independent voltage sources, and independent current sources. It also features a bisection-based optimization engine to find specific component values required to achieve a desired circuit output (voltage, current, or power).</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md24"></a>
Below is a full description of the program focusing on Analysis, Internal Specification and Testing. For External Specification read the readme in root directory <span class="tt">../README.md</span></h2>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md26"></a>
Problem and analysis</h1>
<p><img src="images/aldcc-task-1.jpg" alt="" class="inline"/></p>
<p>Based on the provided code and the task description image, the core problem is the development of a software simulation tool capable of analyzing linear direct current (DC) circuits. The fundamental objective is to parse a textual representation of a circuit, commonly referred to as a netlist, and calculate the steady-state operating point for every component. This involves determining the voltage across, current through, and power dissipated by each resistor, voltage source, and current source in the network.</p>
<p>The mathematical foundation selected to solve this problem is Modified Nodal Analysis (MNA). This approach is necessary because the circuit elements include independent voltage sources, which standard nodal analysis cannot easily handle without supernodes. MNA addresses this by expanding the system of linear equations to solve simultaneously for node potentials and the currents flowing through voltage sources. The program can construct an augmented matrix where rows correspond to Kirchhoff's Current Law (KCL) for each node and the constitutive equations for voltage sources, solving the system Ax=b using Gaussian elimination with partial pivoting to ensure numerical stability.</p>
<p>Several improvements can be made on top of what the task specifies. I decided to add a simple parallel voltage source check and a check for nodes with only current sources connected since these configurations result in the circuit being indeterminate. Obviously in some cases we need the output to be more precise than others and too high precision at all times results in the output being less readable. This is why I also added a third command line switch allowing the user to specify precision of output parameters.</p>
<p>The task mentions only solving a system with known element data and outputting currents, voltages and power balance, but in real use cases I found that I have to perform the opposite almost just as often. This is why I additionally implemented search mode which uses bisection to find some element parameter knowing one of the currents, voltages or power balances. The program still isn't suitable for solving more elaborate problems, but this add-on makes its applicability significantly higher.</p>
<p>I also decided to replace the <span class="tt">I</span> current source symbol from the task decription with <span class="tt">J</span> as it is more commonly used and can't be misinterpretted as current.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md27"></a>
Internal specification</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md28"></a>
Global Context</h2>
<p>The simulation state is aggregated into a central data structure, <a class="el" href="struct_context.html" title="Context">Context</a>, which serves as the primary data transfer object between modules.</p>
<ul>
<li>Element Storage: All circuit components are stored in a std::vector&lt;<a class="el" href="struct_element.html" title="Element">Element</a>&gt;, where each Element contains its type, connection nodes, value, and computed results (voltage, current, power).</li>
<li>Equation System: The MNA system is represented by an augmented matrix (std::vector&lt;std::vector&lt;double&gt;&gt; equations), where the number of unknowns corresponds to the maximum node index plus the number of independent voltage sources.</li>
<li>Bisection State: To support the optimization mode, the context holds a pointer to a variable_elem (the component being tuned) and a <a class="el" href="struct_given_value.html" title="GivenValue">GivenValue</a> structure defining the target metric (desired_value) and type (v_type).</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md29"></a>
Mathematical Core</h2>
<h3 class="doxsection"><a class="anchor" id="autotoc_md30"></a>
Modified Nodal Analysis (MNA)</h3>
<p>The solver constructs a linear system <span class="tt">Ax=b</span> to determine the circuit state.</p>
<p>Equation Formulation:</p><ul>
<li>KCL Equations: Generated for every non-ground node, summing currents leaving the node.</li>
<li>Constitutive Equations: Generated for voltage sources, introducing the source current as an additional unknown.</li>
<li>Ground Reference: The potential of Node <span class="tt">1</span> is explicitly constrained to zero.</li>
</ul>
<p>Matrix Solution:</p><ul>
<li>The system is solved using Gaussian elimination with partial pivoting to maximize numerical stability before decoding the results into node potentials and source currents.</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md31"></a>
Bisection Optimization</h3>
<p>When a variable element is detected, the bisect module wraps the MNA solver in an iterative loop.</p><ul>
<li>Monotonicity Check: The variable element is perturbed by EPSILON (2Eâˆ’10) to determine the sign of the derivative of the output with respect to the input.</li>
<li>Bound Search: The search interval is iteratively doubled until the target value is bracketed by the output range.</li>
<li>Convergence: The algorithm performs a fixed number of iterations (BISECTION_PREC = 50) to narrow the interval, updating the output_value in the <a class="el" href="struct_context.html" title="Context">Context</a> after every step.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md32"></a>
Validation and Error Handling</h2>
<p>The system includes pre-solve validation to reject topologically invalid circuits:</p><ul>
<li>Indeterminate Nodes: Detects nodes connected exclusively to current sources, which result in undefined node potentials.</li>
<li>Parallel Voltage Sources: Identifies voltage sources sharing the same node pair, which creates a singular matrix due to indeterminate loop currents.</li>
<li>Singular Matrices: The Gaussian elimination process throws a runtime error if inconsistent or dependent equations (e.g., 0 = non-zero) are encountered.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md33"></a>
Output Generation</h2>
<p>The simulator writes a comprehensive report to the specified output file.</p><ul>
<li>Element Table: Lists every element's type, nodes, and calculated Voltage (U), Current (I), and Power (P).</li>
<li>Potentials: Lists the calculated electric potential (V) for every node in the circuit.</li>
<li>Formatting: All floating-point values are rounded to the user-specified precision (defaulting to 4 decimal places) using a scaling factor, with specific handling to prevent negative zero outputs.</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md35"></a>
Testing - Basic Mode</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md36"></a>
Example 1</h2>
<p><img src="images/example1.jpg" alt="" class="inline"/></p>
<p>Command: <span class="tt">ALDCCsim.exe -i data.txt -o solution.txt -p 5</span></p>
<p>data.txt: </p><div class="fragment"><div class="line">E 1 2 4</div>
<div class="line">R 2 3 16</div>
<div class="line">R 1 3 16</div>
<div class="line">R 3 4 8</div>
<div class="line">R 1 4 8</div>
<div class="line">J 1 4 6</div>
</div><!-- fragment --><blockquote class="doxtable">
<p>Note: Because we marked the ground node on the left as node <span class="tt">1</span>, we can do the same on the right - they are effectively the same node. </p>
</blockquote>
<p>solution.txt: </p><div class="fragment"><div class="line"> Element |      U[V]     |      I[A]     |      P[W]     </div>
<div class="line">---------+---------------+---------------+---------------</div>
<div class="line">   E12   |             4 |      -0.83333 |       -3.3333 </div>
<div class="line">   R23   |        13.333 |       0.83333 |        11.111 </div>
<div class="line">   R13   |        17.333 |        1.0833 |        18.778 </div>
<div class="line">   R34   |        15.333 |        1.9167 |        29.389 </div>
<div class="line">   R14   |        32.667 |        4.0833 |        133.39 </div>
<div class="line">   J14   |        32.667 |             6 |           196 </div>
<div class="line"> </div>
<div class="line"> Node |      V[V]     </div>
<div class="line">------+---------------</div>
<div class="line">  1   |             0 </div>
<div class="line">  2   |             4 </div>
<div class="line">  3   |        17.333 </div>
<div class="line">  4   |        32.667 </div>
</div><!-- fragment --> <hr  />
 <h2 class="doxsection"><a class="anchor" id="autotoc_md38"></a>
Example 2</h2>
<p><img src="images/example2.jpg" alt="" class="inline"/></p>
<p>Command: <span class="tt">ALDCCsim.exe -i data.txt -o solution.txt</span></p>
<p>data.txt: </p><div class="fragment"><div class="line">R 2 1 4</div>
<div class="line">E 3 2 20</div>
<div class="line">R 3 1 12</div>
<div class="line">R 1 4 4</div>
<div class="line">E 1 6 0</div>
<div class="line">R 3 6 2</div>
<div class="line">R 6 4 4</div>
<div class="line">R 5 4 8</div>
<div class="line">J 5 6 3</div>
</div><!-- fragment --><blockquote class="doxtable">
<p>Note: In this circuit we can model an ideal ammeter using a <span class="tt">0V</span> voltage source. </p>
</blockquote>
<p>solution.txt: </p><div class="fragment"><div class="line"> Element |      U[V]     |      I[A]     |      P[W]     </div>
<div class="line">---------+---------------+---------------+---------------</div>
<div class="line">   R21   |           -14 |          -3.5 |            49 </div>
<div class="line">   E32   |            20 |           3.5 |            70 </div>
<div class="line">   R31   |             6 |           0.5 |             3 </div>
<div class="line">   R14   |            -6 |          -1.5 |             9 </div>
<div class="line">   E16   |             0 |           1.5 |             0 </div>
<div class="line">   R36   |             6 |             3 |            18 </div>
<div class="line">   R64   |            -6 |          -1.5 |             9 </div>
<div class="line">   R54   |            24 |             3 |            72 </div>
<div class="line">   J56   |            30 |             3 |            90 </div>
<div class="line"> </div>
<div class="line"> Node |      V[V]     </div>
<div class="line">------+---------------</div>
<div class="line">  1   |             0 </div>
<div class="line">  2   |            14 </div>
<div class="line">  3   |            -6 </div>
<div class="line">  4   |            -6 </div>
<div class="line">  5   |           -30 </div>
<div class="line">  6   |             0 </div>
</div><!-- fragment --> <hr  />
 <h1 class="doxsection"><a class="anchor" id="autotoc_md40"></a>
Testing - Search Mode</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md41"></a>
Example 1</h2>
<p><img src="images/example3.jpg" alt="" class="inline"/></p>
<p>Command: <span class="tt">ALDCCsim.exe -i data.txt -o solution.txt</span></p>
<p>data.txt: </p><div class="fragment"><div class="line">E 1 2 10</div>
<div class="line">R 2 3 x</div>
<div class="line">R 3 1 50 U 5</div>
</div><!-- fragment --><p>solution.txt: </p><div class="fragment"><div class="line">Answer: x = 50</div>
<div class="line"> </div>
<div class="line"> Element |      U[V]     |      I[A]     |      P[W]     </div>
<div class="line">---------+---------------+---------------+---------------</div>
<div class="line">   E12   |            10 |           0.1 |             1 </div>
<div class="line">   R23   |            -5 |          -0.1 |           0.5 </div>
<div class="line">   R31   |            -5 |          -0.1 |           0.5 </div>
<div class="line"> </div>
<div class="line"> Node |      V[V]     </div>
<div class="line">------+---------------</div>
<div class="line">  1   |             0 </div>
<div class="line">  2   |            10 </div>
<div class="line">  3   |             5 </div>
</div><!-- fragment --> <h2 class="doxsection"><a class="anchor" id="autotoc_md42"></a>
Example 2</h2>
<p><img src="images/example4.jpg" alt="" class="inline"/></p>
<p>Command: <span class="tt">ALDCCsim.exe -i data.txt -o solution.txt -p 7</span></p>
<p>data.txt: </p><div class="fragment"><div class="line">E 5 1 x</div>
<div class="line">R 1 2 3.8</div>
<div class="line">R 2 3 3.8</div>
<div class="line">J 4 2 1.2</div>
<div class="line">R 5 4 3.8</div>
<div class="line">E 5 3 18.5 P 4.9</div>
</div><!-- fragment --><p>solution.txt: </p><div class="fragment"><div class="line">Answer: x = 12</div>
<div class="line"> </div>
<div class="line"> Element |      U[V]     |      I[A]     |      P[W]     </div>
<div class="line">---------+---------------+---------------+---------------</div>
<div class="line">   E51   |            12 |          -1.5 |           -17 </div>
<div class="line">   R12   |           5.6 |           1.5 |           8.2 </div>
<div class="line">   R23   |             1 |          0.26 |          0.27 </div>
<div class="line">   J42   |            22 |           1.2 |            26 </div>
<div class="line">   R54   |          -4.6 |          -1.2 |           5.5 </div>
<div class="line">   E53   |            18 |          0.26 |           4.9 </div>
<div class="line"> </div>
<div class="line"> Node |      V[V]     </div>
<div class="line">------+---------------</div>
<div class="line">  1   |             0 </div>
<div class="line">  2   |           5.6 </div>
<div class="line">  3   |           6.6 </div>
<div class="line">  4   |           -16 </div>
<div class="line">  5   |           -12 </div>
</div><!-- fragment --><p>The same example with higher precision:</p>
<p>Command: <span class="tt">ALDCCsim.exe -i data.txt -o solution.txt -p 5</span></p>
<p>data.txt: </p><div class="fragment"><div class="line">E 5 1 x</div>
<div class="line">R 1 2 3.8</div>
<div class="line">R 2 3 3.8</div>
<div class="line">J 4 2 1.2</div>
<div class="line">R 5 4 3.8</div>
<div class="line">E 5 3 18.5 P 4.9</div>
</div><!-- fragment --><p>solution.txt: </p><div class="fragment"><div class="line">Answer: x = 11.927</div>
<div class="line"> </div>
<div class="line"> Element |      U[V]     |      I[A]     |      P[W]     </div>
<div class="line">---------+---------------+---------------+---------------</div>
<div class="line">   E51   |        11.927 |       -1.4649 |       -17.471 </div>
<div class="line">   R12   |        5.5665 |        1.4649 |        8.1541 </div>
<div class="line">   R23   |        1.0065 |       0.26486 |       0.26658 </div>
<div class="line">   J42   |        22.054 |           1.2 |        26.464 </div>
<div class="line">   R54   |         -4.56 |          -1.2 |         5.472 </div>
<div class="line">   E53   |          18.5 |       0.26486 |           4.9 </div>
<div class="line"> </div>
<div class="line"> Node |      V[V]     </div>
<div class="line">------+---------------</div>
<div class="line">  1   |             0 </div>
<div class="line">  2   |        5.5665 </div>
<div class="line">  3   |         6.573 </div>
<div class="line">  4   |       -16.487 </div>
<div class="line">  5   |       -11.927 </div>
</div><!-- fragment --> <hr  />
 <h2 class="doxsection"><a class="anchor" id="autotoc_md44"></a>
Example 3</h2>
<p><img src="images/example5.jpg" alt="" class="inline"/></p>
<p>Command: <span class="tt">ALDCCsim.exe -i data.txt -o solution.txt -p 7</span></p>
<p>data.txt: </p><div class="fragment"><div class="line">J 3 1 x P 5.5</div>
<div class="line">R 1 2 1</div>
<div class="line">R 2 3 5</div>
<div class="line">R 2 3 20</div>
</div><!-- fragment --><p>solution.txt: </p><div class="fragment"><div class="line">Answer: x = 1.048809</div>
<div class="line"> </div>
<div class="line"> Element |      U[V]     |      I[A]     |      P[W]     </div>
<div class="line">---------+---------------+---------------+---------------</div>
<div class="line">   J31   |      5.244044 |      1.048809 |           5.5 </div>
<div class="line">   R12   |     -1.048809 |     -1.048809 |           1.1 </div>
<div class="line">   R23   |     -4.195235 |    -0.8390471 |          3.52 </div>
<div class="line">   R23   |     -4.195235 |    -0.2097618 |          0.88 </div>
<div class="line"> </div>
<div class="line"> Node |      V[V]     </div>
<div class="line">------+---------------</div>
<div class="line">  1   |             0 </div>
<div class="line">  2   |     -1.048809 </div>
<div class="line">  3   |     -5.244044 </div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.16.1 </li>
  </ul>
</div>
</body>
</html>
